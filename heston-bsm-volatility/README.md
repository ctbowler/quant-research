# ğŸ“ˆ Heston vs Black-Scholes Implied Volatility

This project compares the call option implied volatility (IV) curves generated by the **Black-Scholes model** and the **Heston stochastic volatility model**, using Monte Carlo simulation and numerical inversion.

---

## ğŸ§¾ Model Definitions

### ğŸ”¹ Black-Scholes Model

The Black-Scholes model assumes the asset price follows a geometric Brownian motion with constant volatility:

`dSâ‚œ = rÂ·Sâ‚œÂ·dt + ÏƒÂ·Sâ‚œÂ·dWâ‚œ`


Where:
- `Sâ‚œ`: asset price  
- `r`: risk-free interest rate  
- `Ïƒ`: constant volatility  
- `Wâ‚œ`: standard Brownian motion

The BSM model implies a closed-form solution for European call options and produces a flat IV curve across strikes when volatility is constant. For more information on BSM derivation, see references or https://github.com/ctbowler/prosperity3-trading

---

### ğŸ”¹ Heston Stochastic Volatility Model

The Heston model generalizes the dynamics by allowing the variance `vâ‚œ` to follow its own stochastic process:

`dSâ‚œ = Sâ‚œ Â· (r âˆ’ Â½Â·vâ‚œ)Â·dt + Sâ‚œÂ·âˆšvâ‚œÂ·dWâ‚›`


`dvâ‚œ = ÎºÂ·(Î¸ âˆ’ vâ‚œ)Â·dt + ÏƒÂ·âˆšvâ‚œÂ·dWáµ¥`


With:
- `vâ‚œ`: instantaneous variance  
- `Îº`: rate of mean reversion  
- `Î¸`: long-run variance  
- `Ïƒ`: volatility of volatility  
- `Ï`: correlation between the Brownian motions `dWâ‚›` and `dWáµ¥`

This model captures volatility clustering and produces realistic skew and smile effects in implied volatility surfaces. 

---

## ğŸ”¢ Numerical Simulation (Euler-Maruyama)

To simulate the Heston process over `N` time steps of size `Î”t = T / N`, we employ an Euler-Maruyama algorithm. Although it is similar to the standard forward Euler, this algorithm accounts for stochastic behavior by incorporating ItÃ´'s lemma for the discretization. We then iterate this algorithm over `M = 1000` paths for each strike level. Note that we used a log-Euler discretization for Sâ‚œ, since Sâ‚œ follows a geometric Brownian process. As a result, log(Sâ‚œ) evolves linearly and is normally distributed, making Sâ‚œ lognormally distributed.

### Asset Price Update:

`Sâ‚œâ‚Šâ‚ = Sâ‚œ Â· exp[(r âˆ’ Â½Â·vâ‚œ)Â·Î”t + âˆšvâ‚œÂ·Î”Wâ‚›]`


### Variance Update:

`vâ‚œâ‚Šâ‚ = |vâ‚œ + ÎºÂ·(Î¸ âˆ’ vâ‚œ)Â·Î”t + ÏƒÂ·âˆšvâ‚œÂ·Î”Wáµ¥|`


Where:
- `Î”Wáµ¥ = âˆšdt Â· Zâ‚`, `Î”Wâ‚› = âˆšdt Â· (ÏÂ·Zâ‚ + âˆš(1âˆ’ÏÂ²)Â·Zâ‚‚)` which are obtained by requiring `corr(dWáµ¥, dWâ‚›) = Ï` and `Var(dWáµ¥) = Var(dWâ‚›) = dt`
- `Zâ‚, Zâ‚‚ ~ N(0,1)` i.i.d. standard Gaussians
- Absolute value ensures `vâ‚œâ‚Šâ‚ â‰¥ 0` to avoid negative variances

---

## ğŸ§  Methodology

1. **Simulate Heston Paths**  
   Generate Monte Carlo simulations of `Sâ‚œ` and `vâ‚œ` using the above Euler scheme.

2. **Compute Realized Volatility**  
   Calculate log returns from simulated Heston paths and estimate (annualized) volatility as:  
   `Ïƒ_realized = std(log(Sâ‚œ / Sâ‚œâ‚‹â‚)) Ã— âˆš252`
   
   This is a proxy for a fair "realized" volatility for the Black-Scholes Model (BSM) since we require a constant volatility for BSM price predictions. 


4. **Price European Call Options**  
   For each strike `K`:
   - **Heston price**: Expected payoff using Monte Carlo:  
     `C = exp(âˆ’rÂ·T) Â· mean(max(S_T âˆ’ K, 0))`
   - **Black-Scholes price**:  
     `C = Sâ‚€Â·N(dâ‚) âˆ’ KÂ·exp(âˆ’rÂ·T)Â·N(dâ‚‚)`  
     where:  
     `dâ‚ = [ln(Sâ‚€ / K) + (r + Â½Â·ÏƒÂ²)Â·T] / (ÏƒÂ·âˆšT)`  
     `dâ‚‚ = dâ‚ âˆ’ ÏƒÂ·âˆšT`

5. **Extract Implied Volatility (IV)**  
   Numerically invert the BSM pricing formula using the bisection method to solve for implied volatility `ÏƒÌ‚` such that:  
   `C_observed = BSM_Call(Sâ‚€, K, T, ÏƒÌ‚)`

---

---

## ğŸ“Š Results

This section compares the output of the Heston model and Black-Scholes model across two key dimensions: **implied volatility curves** and **option price levels**.

### 1. Implied Volatility Curve (Calls)

![normal_calls](https://github.com/user-attachments/assets/6f91b8ad-fb96-407f-ba45-1d3de01de057)


- **Heston IV curve (blue)** slopes downward with increasing strike prices, producing a clear **left skew**. This means the market anticipates greater risk in downside movements, which is more consistent with real-world options markets.
- **Black-Scholes IV curve (green, dashed)** is completely flat, reflecting the model's assumption of constant volatility.
- The curves intersect at-the-money (around strike = 100), where the realized volatility (used in BSM) was matched to the Heston simulation. We expect this behavior, as Black Scholes is typically most accurate ATM

ğŸ” **Interpretation**:
- The Heston model naturally captures **skewed volatility surfaces** seen in real markets, whereas Black-Scholes fails to adapt across strikes.
- The shape of the Heston curve emerges directly from its stochastic volatility and negative correlation \( \rho = -0.7 \), which amplifies downside volatility and softens upside exposure.

---

### 2. Option Price Comparison

![output (24)](https://github.com/user-attachments/assets/18e7540b-a6c1-4c16-a59a-3cf9b6d79303)


- The **Heston model (blue)** yields **higher option prices** for deep in-the-money (ITM) strikes (left side of the plot).
- The **Black-Scholes prices (green dashed)** underprice options in this region because it doesnâ€™t adapt to rising volatility during price drops.
- At **at-the-money (ATM)** levels, both models agree â€” again, because Black-Scholes was fed the realized volatility computed from the Heston paths.
- For **deep out-of-the-money (OTM)** options (right side of the plot), Heston prices slightly undercut Black-Scholes. This is due to **mean-reversion in variance**, which dampens large upward price excursions in stochastic volatility models.

ğŸ” **Interpretation**:
- Even with the best possible volatility input, the Black-Scholes model cannot match the shape or behavior of Heston prices outside of the ATM region.
- This validates the need for a stochastic volatility model when pricing volatile options or managing positions across a wide range of strikes.

---

## ğŸ§  Overall Insight

Both plots collectively illustrate that:
- **Black-Scholes performs best at a single point (ATM)** when volatility is well estimated.
- **Heston performs better across the full surface** â€” because it models not just what volatility is, but how it changes.

In practice, this difference matters when trading options portfolios, pricing deep OTM/ITM contracts, or constructing implied volatility surfaces. The Heston model offers structural advantages by encoding realistic market behavior directly into its dynamics.


---

## ğŸ“‚ Files

- `heston_vs_bsm_iv.py` â€” Python script containing full simulation and plots  
- `README.md` â€” This documentation file

---

## ğŸ§© Notes

- Monte Carlo sample size: `M = 1000`  
- Time steps: `N = 252` (daily over 1 year)  
- Spot price: `Sâ‚€ = 100`, Risk-free rate: `r = 0.01`  
- Heston parameters:  
  `Îº = 2.0`, `Î¸ = 0.04`, `Ïƒ = 0.5`, `Ï = âˆ’0.7`, `vâ‚€ = 0.04`

---

---

## ğŸ“š References

- [Black-Scholes Model â€” Wikipedia](https://en.wikipedia.org/wiki/Blackâ€“Scholes_model)  
- [Heston (1993) â€” Original Paper](https://www.math.nyu.edu/faculty/avellane/heston.pdf)  
- [Columbia University â€” Foundations of Financial Engineering Lecture Notes](https://www.columbia.edu/~mh2078/FoundationsFE/BlackScholes.pdf?utm_source=chatgpt.com)  
- [Tucker Balch â€” *Advanced Algorithmic Trading* (2017, AAT eBook)](https://www.amazon.com/dp/B073C12MZ3) â€” content cited from "Introduction to Advanced Algorithmic Trading"



