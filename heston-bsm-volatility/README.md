# 📈 Heston vs Black-Scholes Implied Volatility

This project compares the call option implied volatility (IV) curves generated by the **Black-Scholes model** and the **Heston stochastic volatility model**, using Monte Carlo simulation and numerical inversion.

---

## 🧾 Model Definitions

### 🔹 Black-Scholes Model

The Black-Scholes model assumes the asset price follows a geometric Brownian motion with constant volatility:

`dSₜ = r·Sₜ·dt + σ·Sₜ·dWₜ`


Where:
- `Sₜ`: asset price  
- `r`: risk-free interest rate  
- `σ`: constant volatility  
- `Wₜ`: standard Brownian motion

The BSM model implies a closed-form solution for European call options and produces a flat IV curve across strikes when volatility is constant. For more information on BSM derivation, see references or https://github.com/ctbowler/prosperity3-trading

---

### 🔹 Heston Stochastic Volatility Model

The Heston model generalizes the dynamics by allowing the variance `vₜ` to follow its own stochastic process:

`dSₜ = Sₜ · (r − ½·vₜ)·dt + Sₜ·√vₜ·dWₛ`


`dvₜ = κ·(θ − vₜ)·dt + σ·√vₜ·dWᵥ`


With:
- `vₜ`: instantaneous variance  
- `κ`: rate of mean reversion  
- `θ`: long-run variance  
- `σ`: volatility of volatility  
- `ρ`: correlation between the Brownian motions `dWₛ` and `dWᵥ`

This model captures volatility clustering and produces realistic skew and smile effects in implied volatility surfaces. 

---

## 🔢 Numerical Simulation (Euler-Maruyama)

To simulate the Heston process over `N` time steps of size `Δt = T / N`, we employ an Euler-Maruyama algorithm. Although it is similar to the standard forward Euler, this algorithm accounts for stochastic behavior by incorporating Itô's lemma for the discretization. We then iterate this algorithm over `M = 1000` paths for each strike level. Note that we used a log-Euler discretization for Sₜ, since Sₜ follows a geometric Brownian process. As a result, log(Sₜ) evolves linearly and is normally distributed, making Sₜ lognormally distributed.

### Asset Price Update:

`Sₜ₊₁ = Sₜ · exp[(r − ½·vₜ)·Δt + √vₜ·ΔWₛ]`


### Variance Update:

`vₜ₊₁ = |vₜ + κ·(θ − vₜ)·Δt + σ·√vₜ·ΔWᵥ|`


Where:
- `ΔWᵥ = √dt · Z₁`, `ΔWₛ = √dt · (ρ·Z₁ + √(1−ρ²)·Z₂)` which are obtained by requiring `corr(dWᵥ, dWₛ) = ρ` and `Var(dWᵥ) = Var(dWₛ) = dt`
- `Z₁, Z₂ ~ N(0,1)` i.i.d. standard Gaussians
- Absolute value ensures `vₜ₊₁ ≥ 0` to avoid negative variances

---

## 🧠 Methodology

1. **Simulate Heston Paths**  
   Generate Monte Carlo simulations of `Sₜ` and `vₜ` using the above Euler scheme.

2. **Compute Realized Volatility**  
   Calculate log returns from simulated Heston paths and estimate (annualized) volatility as:  
   `σ_realized = std(log(Sₜ / Sₜ₋₁)) × √252`
   
   This is a proxy for a fair "realized" volatility for the Black-Scholes Model (BSM) since we require a constant volatility for BSM price predictions. 


4. **Price European Call Options**  
   For each strike `K`:
   - **Heston price**: Expected payoff using Monte Carlo:  
     `C = exp(−r·T) · mean(max(S_T − K, 0))`
   - **Black-Scholes price**:  
     `C = S₀·N(d₁) − K·exp(−r·T)·N(d₂)`  
     where:  
     `d₁ = [ln(S₀ / K) + (r + ½·σ²)·T] / (σ·√T)`  
     `d₂ = d₁ − σ·√T`

5. **Extract Implied Volatility (IV)**  
   Numerically invert the BSM pricing formula using the bisection method to solve for implied volatility `σ̂` such that:  
   `C_observed = BSM_Call(S₀, K, T, σ̂)`

---

---

## 📊 Results

This section compares the output of the Heston model and Black-Scholes model across two key dimensions: **implied volatility curves** and **option price levels**.

### 1. Implied Volatility Curve (Calls)

![normal_calls](https://github.com/user-attachments/assets/6f91b8ad-fb96-407f-ba45-1d3de01de057)


- **Heston IV curve (blue)** slopes downward with increasing strike prices, producing a clear **left skew**. This means the market anticipates greater risk in downside movements, which is more consistent with real-world options markets.
- **Black-Scholes IV curve (green, dashed)** is completely flat, reflecting the model's assumption of constant volatility.
- The curves intersect at-the-money (around strike = 100), where the realized volatility (used in BSM) was matched to the Heston simulation. We expect this behavior, as Black Scholes is typically most accurate ATM

🔎 **Interpretation**:
- The Heston model naturally captures **skewed volatility surfaces** seen in real markets, whereas Black-Scholes fails to adapt across strikes.
- The shape of the Heston curve emerges directly from its stochastic volatility and negative correlation \( \rho = -0.7 \), which amplifies downside volatility and softens upside exposure.

---

### 2. Option Price Comparison

![output (24)](https://github.com/user-attachments/assets/18e7540b-a6c1-4c16-a59a-3cf9b6d79303)


- The **Heston model (blue)** yields **higher option prices** for deep in-the-money (ITM) strikes (left side of the plot).
- The **Black-Scholes prices (green dashed)** underprice options in this region because it doesn’t adapt to rising volatility during price drops.
- At **at-the-money (ATM)** levels, both models agree — again, because Black-Scholes was fed the realized volatility computed from the Heston paths.
- For **deep out-of-the-money (OTM)** options (right side of the plot), Heston prices slightly undercut Black-Scholes. This is due to **mean-reversion in variance**, which dampens large upward price excursions in stochastic volatility models.

🔎 **Interpretation**:
- Even with the best possible volatility input, the Black-Scholes model cannot match the shape or behavior of Heston prices outside of the ATM region.
- This validates the need for a stochastic volatility model when pricing volatile options or managing positions across a wide range of strikes.

---

## 🧠 Overall Insight

Both plots collectively illustrate that:
- **Black-Scholes performs best at a single point (ATM)** when volatility is well estimated.
- **Heston performs better across the full surface** — because it models not just what volatility is, but how it changes.

In practice, this difference matters when trading options portfolios, pricing deep OTM/ITM contracts, or constructing implied volatility surfaces. The Heston model offers structural advantages by encoding realistic market behavior directly into its dynamics.


---

## 📂 Files

- `heston_vs_bsm_iv.py` — Python script containing full simulation and plots  
- `README.md` — This documentation file

---

## 🧩 Notes

- Monte Carlo sample size: `M = 1000`  
- Time steps: `N = 252` (daily over 1 year)  
- Spot price: `S₀ = 100`, Risk-free rate: `r = 0.01`  
- Heston parameters:  
  `κ = 2.0`, `θ = 0.04`, `σ = 0.5`, `ρ = −0.7`, `v₀ = 0.04`

---

---

## 📚 References

- [Black-Scholes Model — Wikipedia](https://en.wikipedia.org/wiki/Black–Scholes_model)  
- [Heston (1993) — Original Paper](https://www.math.nyu.edu/faculty/avellane/heston.pdf)  
- [Columbia University — Foundations of Financial Engineering Lecture Notes](https://www.columbia.edu/~mh2078/FoundationsFE/BlackScholes.pdf?utm_source=chatgpt.com)  
- [Tucker Balch — *Advanced Algorithmic Trading* (2017, AAT eBook)](https://www.amazon.com/dp/B073C12MZ3) — content cited from "Introduction to Advanced Algorithmic Trading"



